import{d as w,b as Q,m as W,r as Y,u as X,e as g,B as Z,j as e,A as ee,q as re,v as ae,w as v,D as N,x as oe,s as se,_ as te}from"./index-24cbb48d.js";import{d as T,u as H,f as ie,e as ne,h as le,b as ce,i as de,j as ue,p as me,B as V}from"./App-ec79eecb.js";import{S as L}from"./TextInput-3ec438f9.js";import{T as he,C as fe}from"./CurrencyInput-8366cb45.js";import{I as ve}from"./IconTrash-7e6cab92.js";import{c as S}from"./createReactComponent-562ea440.js";import{T as j}from"./Text-43ce0d24.js";import{A as y,u as ge}from"./use-form-c1c7bdd5.js";import{n as b}from"./events-44cf26f1.js";import"./MemoryRouter-fcfce698.js";import"./extends-98964cd2.js";var xe=Object.defineProperty,je=Object.defineProperties,pe=Object.getOwnPropertyDescriptors,R=Object.getOwnPropertySymbols,ye=Object.prototype.hasOwnProperty,Pe=Object.prototype.propertyIsEnumerable,B=(r,a,o)=>a in r?xe(r,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[a]=o,$=(r,a)=>{for(var o in a||(a={}))ye.call(a,o)&&B(r,o,a[o]);if(R)for(var o of R(a))Pe.call(a,o)&&B(r,o,a[o]);return r},Ie=(r,a)=>je(r,pe(a));const be={xs:w(16),sm:w(20),md:w(26),lg:w(32),xl:w(40)},Te=["filled","light","gradient","outline","default"];function we({theme:r,variant:a,color:o,gradient:s}){if(!Te.includes(a))return null;const t=r.fn.variant({variant:a,color:o||r.primaryColor,gradient:s,primaryFallback:!1});return{backgroundColor:t.background,color:t.color,backgroundImage:a==="gradient"?t.background:void 0,border:`${w(a==="gradient"?0:1)} solid ${t.border}`}}var Oe=Q((r,{color:a,radius:o,gradient:s},{variant:t,size:l})=>{const n=W({size:l,sizes:be});return{root:$(Ie($({},r.fn.fontStyles()),{display:"inline-flex",alignItems:"center",justifyContent:"center",boxSizing:"border-box",width:n,height:n,minWidth:n,minHeight:n,borderRadius:r.fn.radius(o)}),we({theme:r,variant:t,gradient:s,color:a}))}});const Ce=Oe;var Se=Object.defineProperty,M=Object.getOwnPropertySymbols,q=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,J=(r,a,o)=>a in r?Se(r,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[a]=o,ke=(r,a)=>{for(var o in a||(a={}))q.call(a,o)&&J(r,o,a[o]);if(M)for(var o of M(a))U.call(a,o)&&J(r,o,a[o]);return r},De=(r,a)=>{var o={};for(var s in r)q.call(r,s)&&a.indexOf(s)<0&&(o[s]=r[s]);if(r!=null&&M)for(var s of M(r))a.indexOf(s)<0&&U.call(r,s)&&(o[s]=r[s]);return o};const Fe={size:"md",variant:"filled"},_=Y.forwardRef((r,a)=>{const o=X("ThemeIcon",Fe,r),{className:s,size:t,radius:l,variant:n,color:u,children:d,gradient:p,unstyled:x}=o,c=De(o,["className","size","radius","variant","color","children","gradient","unstyled"]),{classes:m,cx:h}=Ce({variant:n,radius:l,color:u,gradient:p},{name:"ThemeIcon",unstyled:x,variant:n,size:t});return g.createElement(Z,ke({className:h(m.root,s),ref:a},c),d)});_.displayName="@mantine/core/ThemeIcon";var Ne=S("brand-mastercard","IconBrandMastercard",[["path",{d:"M14 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0",key:"svg-0"}],["path",{d:"M12 9.765a3 3 0 1 0 0 4.47",key:"svg-1"}],["path",{d:"M3 5m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z",key:"svg-2"}]]),_e=S("brand-visa","IconBrandVisa",[["path",{d:"M21 15l-1 -6l-2.5 6",key:"svg-0"}],["path",{d:"M9 15l1 -6",key:"svg-1"}],["path",{d:"M3 9h1v6h.5l2.5 -6",key:"svg-2"}],["path",{d:"M16 9.5a.5 .5 0 0 0 -.5 -.5h-.75c-.721 0 -1.337 .521 -1.455 1.233l-.09 .534a1.059 1.059 0 0 0 1.045 1.233a1.059 1.059 0 0 1 1.045 1.233l-.09 .534a1.476 1.476 0 0 1 -1.455 1.233h-.75a.5 .5 0 0 1 -.5 -.5",key:"svg-3"}],["path",{d:"M18 14h2.7",key:"svg-4"}]]),Me=S("cash","IconCash",[["path",{d:"M7 9m0 2a2 2 0 0 1 2 -2h10a2 2 0 0 1 2 2v6a2 2 0 0 1 -2 2h-10a2 2 0 0 1 -2 -2z",key:"svg-0"}],["path",{d:"M14 14m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M17 9v-2a2 2 0 0 0 -2 -2h-10a2 2 0 0 0 -2 2v6a2 2 0 0 0 2 2h2",key:"svg-2"}]]),Ee=S("mood-happy","IconMoodHappy",[["path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0",key:"svg-0"}],["path",{d:"M9 9l.01 0",key:"svg-1"}],["path",{d:"M15 9l.01 0",key:"svg-2"}],["path",{d:"M8 13a4 4 0 1 0 8 0h-8",key:"svg-3"}]]),Ae=S("ticket","IconTicket",[["path",{d:"M15 5l0 2",key:"svg-0"}],["path",{d:"M15 11l0 2",key:"svg-1"}],["path",{d:"M15 17l0 2",key:"svg-2"}],["path",{d:"M5 5h14a2 2 0 0 1 2 2v3a2 2 0 0 0 0 4v3a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-3a2 2 0 0 0 0 -4v-3a2 2 0 0 1 2 -2",key:"svg-3"}]]),ze=S("truck-delivery","IconTruckDelivery",[["path",{d:"M7 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-0"}],["path",{d:"M17 17m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0",key:"svg-1"}],["path",{d:"M5 17h-2v-4m-1 -8h11v12m-4 0h6m4 0h2v-6h-8m0 -5h5l3 5",key:"svg-2"}],["path",{d:"M3 9l4 0",key:"svg-3"}]]);const K=Q(r=>({container:{backgroundColor:r.colors.white,padding:"0.5rem",minWidth:"80vw",maxWidth:"80vw",boxShadow:r.shadows.md,borderRadius:"0.5rem"},header:{position:"sticky",top:0,backgroundColor:r.colorScheme==="dark"?r.colors.dark[7]:r.white,transition:"box-shadow 150ms ease","&::after":{content:'""',position:"absolute",left:0,right:0,bottom:0,borderBottom:`${w(1)} solid ${r.colorScheme==="dark"?r.colors.dark[3]:r.colors.gray[2]}`}},scrolled:{boxShadow:r.shadows.sm},row:{maxHeight:"2rem",height:"2rem"}})),Ge=r=>{const{classes:a,cx:o}=K(),[s,t]=g.useState(!1);return e.jsxs("div",{children:[e.jsx(L,{h:"30vh",mah:"50vh",w:"80%",onScrollPositionChange:({y:l})=>t(l!==0),children:e.jsxs(he,{striped:!0,highlightOnHover:!0,withBorder:!0,sx:{tableLayout:"fixed"},children:[e.jsx("thead",{className:o(a.header,{[a.scrolled]:s}),children:e.jsxs("tr",{children:[e.jsx("th",{children:"Forma"}),e.jsx("th",{children:"Valor"}),e.jsx("th",{children:"Parcelas"}),e.jsx("th",{children:"Valor parcela"}),e.jsx("th",{})]})}),e.jsx("tbody",{className:a.row,children:r.data.map((l,n)=>e.jsxs("tr",{className:a.row,children:[e.jsx("td",{children:l.descricao}),e.jsx("td",{children:T.format(l.valor)}),e.jsxs("td",{children:[l.parcela,"x"]}),e.jsx("td",{children:T.format(l.valorParcela)}),e.jsx("td",{children:e.jsx(ee,{color:"red",onClick:u=>{var d;u.preventDefault(),(d=r.onDelete)==null||d.call(r,l)},children:e.jsx(ve,{size:"1.5rem"})})})]},l.id+n))})]})}),r.customFooter]})},Ve=async r=>{const a=Re(),o=await re(a,[]),s=[];for(const t of o){const l=s.findIndex(c=>c.id===String(t.CODPDVFPG)),n=t.JUROS?t.JUROS>0:!1;let u=r/(t.QTDPMIN||1);if(n&&t.JUROS&&t.QTDPMIN!==null){const c=t.QTDPMIN,m=t.JUROS/100;u=Number.parseFloat(((1+m)**c*m/((1+m)**c-1)*r).toFixed(1))}const d=t.QTDPMIN||1,p=String(t.QTDPMIN),x=String(t.CODIFPG);if(l===-1)s.push({id:String(t.CODPDVFPG),descricao:String(t.NOME),bandeira:void 0,parcelas:[{id:x,descricao:p,juros:n,valor:u,vezes:d}],tipoTitulo:`${t.CODTIPTIT}`});else{const c=s[l].parcelas;Array.isArray(c)&&(s[l].parcelas=[...c,{id:x,descricao:p,juros:n,valor:u,vezes:d}].sort((m,h)=>m.descricao.localeCompare(h.descricao)))}}return s};function Re(){return`SELECT distinct IFPG.CODPDVFPG||'-'||IFPG.CODIFPG as CODFORMA,IFPG.JUROS,IFPG.CODPDVFPG,IFPG.CODIFPG, FPG.NOME, TIT.DESCRTIPTIT, IFPG.VLRMIN,IFPG.QTDPMIN,IFPG.QTDPMAX,IFPG.CODTIPTIT  FROM AD_PDVIFPG IFPG
  INNER JOIN AD_PDVFPG FPG
 ON IFPG.CODPDVFPG = FPG.CODPDVFPG
  INNER JOIN TGFTIT TIT
 ON IFPG.CODTIPTIT = TIT.CODTIPTIT`}const Be=r=>{const[a,o]=g.useState(null),[s,t]=g.useState(r.values.subTotal),[l,n]=g.useState("dadosPedido"),u=ae("(min-width: 88em)"),d=g.useMemo(()=>u?"50vh":"35vh",[u]),[p,x]=H(ie),c=g.useCallback(i=>{if(i.descricao.toLowerCase().includes("cartão")){if(!i.bandeira)return e.jsx(ne,{size:"2rem",color:"purple"});if(i.bandeira.toLowerCase().includes("visa"))return e.jsx(_e,{size:"2rem",color:"blue"});if(i.bandeira.toLowerCase().includes("mastercard"))return e.jsx(Ne,{size:"2rem",color:"orange"})}return i.descricao.toLowerCase().includes("dinheiro")?e.jsx(Me,{size:"2rem",color:"lime"}):e.jsx(Ae,{size:"2rem",color:"gray"})},[]),m=g.useRef(null),h=(i,f,P)=>{var A,z,G;const C=p.find(E=>E.id==f);if(!C||!Array.isArray(C.parcelas))return;const F=C.parcelas.find(E=>E.id==P);if(!F)return;const I=document.getElementById(P);if(I)switch(i.key){case"ArrowUp":{i.stopPropagation(),(A=I==null?void 0:I.previousElementSibling)==null||A.focus();break}case"ArrowDown":{i.stopPropagation(),(z=I==null?void 0:I.nextElementSibling)==null||z.focus();break}case"Enter":{if(i.stopPropagation(),s>r.values.subTotal)return b.show({title:"Valor inválido",message:"O valor informado é maior que o valor máximo",color:"red"});if(Number.isNaN(s))return b.show({title:"Valor inválido",message:"O valor informado é inválido",color:"red"});(G=r.onClick)==null||G.call(r,C,F,s),o(null),t(r.values.subTotal-s);break}}},O=()=>p.map(i=>e.jsxs(y.Item,{value:i.id,children:[i.descricao&&e.jsx(y.Control,{icon:c(i),disabled:r.values.subTotal===0,children:i.descricao}),e.jsx(y.Panel,{children:e.jsx(v,{direction:"column",ref:m,children:Array.isArray(i.parcelas)&&i.parcelas.map(f=>e.jsxs(v,{id:f.id,gap:10,tabIndex:0,sx:{":hover":{backgroundColor:"#e5e5e5",cursor:"pointer"},":focus":{backgroundColor:"#e5e5e5",cursor:"pointer",outline:"none"}},justify:"center",align:"center",onClick:()=>{var P;if(s>r.values.subTotal)return b.show({title:"Valor inválido",message:"O valor informado é maior que o valor máximo",color:"red"});if(Number.isNaN(s))return b.show({title:"Valor inválido",message:"O valor informado é inválido",color:"red"});(P=r.onClick)==null||P.call(r,i,f,s),o(null),t(r.values.subTotal-s)},onKeyDown:P=>{h(P,i.id,f.id)},children:[e.jsx(j,{w:20,children:f.descricao}),e.jsx(j,{w:100,children:f.valor&&T.format(f.valor)}),e.jsx(j,{children:f.juros?"com juros":"sem juros"})]},f.id))})})]},i.id)),k=g.useCallback(async()=>{const i=await Ve(s);x(i)},[s,x]),D=g.useMemo(()=>()=>e.jsxs(v,{gap:20,children:[e.jsx(_,{size:"lg",variant:"gradient",gradient:{from:"#70e47f",to:"#00c41a"},children:e.jsx(le,{size:"1.2rem"})}),e.jsx(j,{fs:"normal",fz:"lg",fw:500,color:"gray",children:e.jsxs(v,{direction:"row",gap:5,children:["Total:",e.jsx(j,{color:"#70e47f",children:T.format(r.values.total)})]})})]}),[r.values.total]);return g.useEffect(()=>{k()},[k]),g.useEffect(()=>{t(r.values.subTotal)},[r.values.subTotal]),e.jsx(v,{direction:"column",miw:"30%",sx:{borderRadius:"0.5rem"},mih:"65vh",children:e.jsxs(y,{defaultValue:"dadosPedido",onChange:i=>{n(i)},children:[e.jsxs(y.Item,{value:"dadosPedido",children:[e.jsx(y.Control,{children:l==="dadosPedido"?e.jsx(j,{size:20,color:"gray",children:"Dados pedido"}):e.jsx(D,{})}),e.jsx(y.Panel,{children:e.jsxs(N,{p:5,children:[e.jsx(N,{shadow:"xs",p:"xs",m:"xs",children:e.jsx(D,{})}),e.jsx(N,{shadow:"xs",p:"xs",m:"xs",children:e.jsxs(v,{gap:20,children:[e.jsx(_,{size:"lg",variant:"gradient",gradient:{from:"#f1cf5d",to:"#fac000"},children:e.jsx(Ee,{size:"1.2rem"})}),e.jsx(j,{fs:"normal",fz:"lg",fw:"",color:"gray",children:e.jsxs(v,{direction:"row",gap:5,children:["Adicionas:",e.jsx(j,{color:"#70e47f",children:T.format(r.values.adicionais)})]})})]})}),e.jsx(N,{shadow:"xs",p:"xs",m:"xs",children:e.jsxs(v,{gap:20,children:[e.jsx(_,{size:"lg",variant:"gradient",gradient:{from:"#6fffff",to:"#00afaf"},children:e.jsx(ze,{size:"1.2rem"})}),e.jsx(j,{fs:"normal",fz:"lg",fw:500,color:"gray",children:e.jsxs(v,{direction:"row",gap:5,children:["Frete:",e.jsx(j,{color:"#70e47f",children:T.format(r.values.frete)})]})})]})})]})})]}),e.jsxs(y.Item,{value:"formasPagamento",children:[e.jsx(v,{justify:"center",align:"center",children:e.jsx(y.Control,{children:e.jsx(j,{size:20,color:"gray",children:"Formas de pagamento"})})}),e.jsxs(y.Panel,{children:[e.jsxs(v,{justify:"space-around",children:[e.jsx(j,{size:20,color:"green",children:"Valor:"}),e.jsx(fe,{max:r.values.subTotal,required:!0,value:s,onChange:i=>{const f=Number(i.currentTarget.value);t(f)},w:100,size:"xs",ml:"xl",disabled:r.values.subTotal===0})]}),e.jsx(L,{mah:d,h:d,children:e.jsx(y,{value:a,variant:"filled",onChange:o,children:e.jsx(O,{})})})]})]})]})})},er=r=>{const{formID:a,onSubmit:o}=r,{classes:s}=K(),[t,l]=H(ue),{total:n}=ce(me),u=g.useMemo(()=>t.reduce((m,h)=>m-h.valor,n),[t,n]),d=g.useMemo(()=>t.reduce((m,h)=>m+h.valorParcela*Number(h.parcela),0),[t]),p=ge({initialValues:{totalAPagar:d,total:n,subTotal:u},validate:{totalAPagar:()=>d==0?(b.show({title:"Erro",message:"O total a pagar não pode ser zero",color:"red"}),!0):null,total:()=>n==0?(b.show({title:"Erro",message:"O total não pode ser zero",color:"red"}),!0):null,subTotal:()=>u==0?null:(b.show({title:"Erro",message:"O sub.Total precisa ser totalmente consumido!",color:"red"}),!0)}}),x=(m,h,O)=>{const{descricao:k,bandeira:D,tipoTitulo:i}=m,{valor:f,juros:P,descricao:C}=h;if(O!=0){const F={descricao:k,id:`${t.length}`,bandeira:D,valorParcela:f||0,juros:P||!1,parcela:C,valor:O,tipoTitulo:i};l(I=>[...I,F])}},c=()=>e.jsxs(v,{w:"100%",mt:20,direction:"row-reverse",gap:20,children:[e.jsxs(V,{color:"blue",variant:"dot",size:"lg",radius:0,children:["Total pago: ",T.format(d)]}),e.jsxs(V,{color:"green",variant:"dot",size:"lg",radius:0,children:["Saldo a pagar ",T.format(u)]})]});return e.jsxs(v,{w:"100%",justify:"center",children:[e.jsx(oe,{onClick:()=>$e(),children:"Testar tef"}),e.jsx("form",{onSubmit:p.onSubmit(()=>{o==null||o({subTotal:u,total:n,totalAPagar:d})}),id:a,children:e.jsxs(v,{gap:50,className:s.container,bg:"white",children:[e.jsx(Be,{onClick:x,values:{total:n,adicionais:0,frete:0,subTotal:u}}),e.jsx(Ge,{data:t,onDelete:m=>{l(h=>h.filter(O=>O.id!==m.id))},customFooter:e.jsx(c,{})})]})})]})},$e=async()=>{if(se()){const r=new Headers;r.append("Content-Type","application/json"),r.append("Cookie","JSESSIONID=AK6VpXKHWQ2QymyFGWAQuohep2oKKb7z4AYE_9D_.master");const a=JSON.stringify({serviceName:"RecebimentoComCartaoSP.gerarNumeroIdentificacao",requestBody:{params:[],clientEventList:[]}}),o={method:"POST",headers:r,body:a,redirect:"follow"},{ok:s,data:t}=await de("/mge/service.sbr?serviceName=RecebimentoComCartaoSP.gerarNumeroIdentificacao&outputType=json",o);if(!s){b.show({title:"Erro",message:"Não foi possível iniciar o TEF! Erro ao gerar idenficador",color:"red"});return}const{responseBody:{info:{IDENTIFICACAOTEF:{$:l}}}}=t;let n=new Date;n=n.toLocaleString("pt-br").replace(",","");const u=window.location.origin;await te(()=>import(`${u}/mge/js/tef.js`),[]);const d=new WebSocket("ws://localhost:9098/tef");d.onopen=()=>{d.send(JSON.stringify({operacao:"-127001",gateway:"PAYGO"})),d.onmessage=p=>{const{data:x}=p;if(console.log(x),!x)return;const c=JSON.parse(x);c!=null&&c.display&&c.display.length>0&&b.show({title:"Erro",message:c.display[0].mensagem,color:"red"}),c.retorno&&c.retorno==="0"&&d.send(JSON.stringify({operacao:"113",valorTransacao:"1000",numeroTransacao:"1",numeroParcelas:"2",dataTransacao:n,gateway:"PAYGO",identificacao:l,cnpjcpfEstabelecimento:"06837645000160"}))}}}};export{er as default};
